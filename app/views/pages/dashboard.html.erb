<div class="body-dashboard">
  <div class="container">
    <div class="main-body">
      <div class="row">
        <div class="col-lg-3">
          <div class="card-profil mb-3 mt-3 shadow-sm">
            <div class="card-body">
              <div class="d-flex flex-column align-items-center text-center">
                <% if current_user.avatar.attached? %>
                  <%= cl_image_tag current_user.avatar.key, class: "avatar-large" %>
                <% else %>
                  <%= image_tag asset_url("placeholder-avatar.png"), class: "avatar-large" %>
                <% end %>
                <div class="mt-3">
                  <h4><%= "#{@user.first_name} #{@user.last_name}" %></h4>
                  <p class="text-secondary mb-1">Full Stack Developer</p>
                  <p class="text-muted font-size-sm"><%= @user.address %></p>
                </div>
              </div>
            </div>
          </div>
          <!-- SOCIAL MEDIA LINKS -->
          <%# <div class="card-dashboard mb-3 shadow-sm">
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                  <h6 class="mb-0"><i class="fab fa-github"></i> Github</h6>
                  <span class="text-secondary"><%= @user.link_github %></span>
                <%# </li>
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                  <h6 class="mb-0"><i class="fas fa-laptop-code"></i> Malt</h6>
                  <%# <span class="text-secondary"><%= @user.link_malt %></span>
                <%# </li> %>
                <%# <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                  <h6 class="mb-0"><i class="fab fa-slack"></i> Slack</h6>
                  <span class="text-secondary"><%= @user.link_slack %></span>
                <%# </li>
              </ul> %>
            <%# </div>
          </div> %>
        </div>
        <div class="col-lg-9">
          <div class="d-flex card-dashboard mb-3 mt-3 shadow-sm">
            <div class="card-body">
              <h5 class="d-flex align-items-center mb-3">My level experience</h5>
              <div class="progress card-level">
                  <div class="progress-bar progress-bar-striped progress-bar-animated rounded" role="progressbar" aria-valuenow="<%= @user.xp_level %>"  aria-valuemin="0" aria-valuemax="100" style="width: <%= @user.xp_level %>%"><%= @user.xp_level %>%</div>
              </div>
              <p class="text-primary text-center fs-6">7 missions to get to the next level! </p>
              <div class="d-flex justify-content-around">
                <div>
                  <div class="card-level m-3">
                    <h5>Complited profil</h5>
                  </div>
                  <div class="card-level m-3">
                    <h5>Missions</h5>
                  </div>
                  <div class="card-level m-3">
                    <h5>Reviews</h5>
                  </div>
                </div>
                <div class="card-level m-3">
                    <h5>Your level</h5>
                </div>
              </div>
            </div>
            <hr class="hr-dashboard">
            <div class="card-body">
              <div class="card-next-level">
                <h5>Next level</h5>
                <h6>Icon</h6>
                <h6>Description</h6>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <h5 class="align-items-center m-3">My mentors</h5>
          <div class="bubbles m-3" data-controller="tippy">
          <!-- MENTORS ACCEPTED -->
            <div class="mentor_bubbles">
              <% @mentors.each do |mentor| %>
                <%= link_to mentor_path(mentor) do %>
                  <% if mentor.avatar.attached? %>
                    <%= cl_image_tag mentor.avatar.key, class: "avatar-medium", data: { tippy_target: "avatar", content: mentor.name} %>
                  <% else %>
                    <%= image_tag asset_url("placeholder-avatar.png"), class:"avatar-medium", data: { tippy_target: "avatar", content: mentor.name} %>
                  <% end %>
                  <%= image_tag("check.png", class:"avatar-status") %>
                <% end %>
              <% end %>
            </div>
            <!-- MENTORS PENDING OR DENIED -->
            <div class="mentor_bubbles">
              <% @applied_mentors.each do |applied_mentor| %>
                <%= link_to mentor_path(applied_mentor) do %>
                  <% if applied_mentor.avatar.attached? %>
                    <%= cl_image_tag applied_mentor.avatar.key, class: "avatar-medium", data: { tippy_target: "avatar", content: applied_mentor.name } %>
                  <% else %>
                    <%= image_tag asset_url("placeholder-avatar.png"), class: "avatar-medium", data: { tippy_target: "avatar", content: applied_mentor.name } %>
                  <% end %>
                  <% case current_user.relationship_request_status(applied_mentor) %>
                  <% when "not_connected" %>
                    <%= image_tag("remove.png", class:"avatar-status") %></p>
                  <% else %>
                    <%= image_tag("minuteur.png", class:"avatar-status2") %></p>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card-dashboard mb-3 shadow-sm">
            <div class="card-body">
            <h5 class="d-flex align-items-center mb-3">My missions</h5>
              <!-- MISSIONS ACCEPTED -->
              <div class="list-group">
                <% @missions.each do |mission| %>
                  <div class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                      <h5 class="mb-1"><%= mission.name %></h5>
                      <small>
                        <ul class="list-inline d-flex justify-content-between">
                          <li class="list-inline-item">
                            <%= image_tag("company.png", style:"width: 25px;") %> <%= mission.company %>
                          </li>
                          <li class="list-inline-item">
                            <%= image_tag("Time.png", style:"width: 25px;") %> <%= mission.duration %>
                          </li>
                          <li class="list-inline-item">
                            <%= image_tag("money.png", style:"width: 25px;") %> <%= mission.fee %>â‚¬
                          </li>
                        </ul>
                      </small>
                    </div>
                    <% case mission.status %>
                    <% when "on_going" %>
                      <p class="text-center fs-3 m-0"><span class="text-success">ONGOING <i class="fas fa-plane-departure"></span></i></p>
                    <% when "finished" %>
                      <p class="text-center fs-3 m-0"><span class="text-muted">FINISHED <i class="fas fa-plane-arrival"></span></i></p>
                    <% else %>
                      <p class="text-center fs-5 m-0">WILL BEGIN IN <%= "#{(mission.start_date - Date.today).to_i} DAYS" %></i></p>
                    <% end %>
                    <p class="mb-1"><%= mission.description %></p>
                      <!-- CREATE REVIEW IF NOT EXIST, UPDATE OTHERWISE-->
                    <div class="review">
                      <% if mission.reviews.exists?(reviewer: current_user) && mission.status == "finished" %>
                        <div class="mission-review">
                          <div class="review-info">
                            <p><%= mission.reviews.find_by(reviewer: current_user).content %></p>
                          </div>
                            <% rating = mission.reviews.find_by(reviewer: current_user).rating %>
                            <% rating.times do %>
                              <i class="fas fa-star"></i>
                            <% end %>
                            <% (5 - rating).times do %>
                              <i class="far fa-star"></i>
                            <% end %>
                          <i class="fas fa-pencil-alt", data-bs-toggle="collapse" data-bs-target="#edit_review_2"></i>
                          <%= render "shared/new-review", mission: mission, review: mission.reviews.find_by(reviewer: current_user) %>
                        </div>
                      <% elsif mission.status == "finished" %>
                        <button class='btn btn-yellow', data-bs-toggle="collapse" data-bs-target="#new_review">Create Review</button>
                        <div class="mission-review">
                          <%= render "shared/new-review", mission: mission, review: Review.new %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                  <!--
                  <% case mission.status %>
                  <% when "on_going" %>
                    <p class="text-center fs-3 m-0"><span class="text-success">ONGOING <i class="fas fa-plane-departure"></span></i></p>
                  <% when "finished" %>
                    <p class="text-center fs-3 m-0"><span class="text-muted">FINISHED <i class="fas fa-plane-arrival"></span></i></p>
                  <% else %>
                    <p class="text-center fs-5 m-0">WILL BEGIN IN <%= "#{(mission.start_date - Date.today).to_i} DAYS" %></i></p>
                  <% end %>
                    <p class="mb-1"><%= mission.description %></p> -->
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <!-- MISSIONS WHERE APPLICATION IS PENDING OR DENIED -->
        <div class="list-group transparent mt-3">
          <% @applied_missions.each do |applied_mission| %>
            <div class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1"><%= applied_mission.name %></h5>
                  <small>
                    <ul class="list-inline d-flex justify-content-between">
                      <li class="list-inline-item">
                        <%= image_tag("company.png", style:"width: 25px;") %> <%= applied_mission.company %>
                      </li>
                      <li class="list-inline-item">
                        <%= image_tag("Time.png", style:"width: 25px;") %> <%= applied_mission.duration %>
                      </li>
                      <li class="list-inline-item">
                        <%= image_tag("money.png", style:"width: 25px;") %> <%= applied_mission.fee %>
                      </li>
                    </ul>
                  </small>
              </div>
              <% case applied_mission.application_status(current_user) %>
              <% when "denied" %>
                <p class="text-center fs-5 m-0">Application <span class="text-danger">DENIED <i class="fas fa-times"></i></span></i></p>
              <% else %>
                <p class="text-center fs-5 m-0">Application <span class="text-secondary">PENDING</span></i></p>
              <% end %>
                <p class="mb-1"><%= applied_mission.description %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
